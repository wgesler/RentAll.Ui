@if (isLoading) {
  <div class="loading-container">
    <mat-spinner [diameter]="40"></mat-spinner>
    <p>Loading emails...</p>
  </div>
} @else if (!isServiceError) {
  @if (hideHeader) {
    <div class="document-list-tab-container">
      <div class="flex gap-4 items-center mt-3 px-4">
        @if (showOfficeDropdown) {
          <mat-form-field appearance="outline" style="width: 300px;">
            <mat-label>{{ selectedOfficeId ? 'Office' : 'All Offices' }}</mat-label>
            <mat-select [(ngModel)]="selectedOfficeId" (selectionChange)="onOfficeChange()" [disabled]="source === 'property' || source === 'reservation'" placeholder="All Offices">
              <mat-option [value]="null">All Offices</mat-option>
              @for (office of offices; track office.officeId) {
                <mat-option [value]="office.officeId">{{ office.name }}</mat-option>
              }
            </mat-select>
          </mat-form-field>
        }
        @if (source === 'invoice') {
          <mat-form-field appearance="outline" style="width: 300px;">
            <mat-label>{{ selectedCompany ? 'Company' : 'All Companies' }}</mat-label>
            <mat-select [(ngModel)]="selectedCompany" (selectionChange)="onCompanyChange()">
              <mat-option [value]="null">All Companies</mat-option>
              @for (company of availableCompanies; track company.value.companyId) {
                <mat-option [value]="company.value">{{ company.label }}</mat-option>
              }
            </mat-select>
          </mat-form-field>
        }
        @if (source === 'property' || source === 'reservation') {
          <mat-form-field appearance="outline" class="flex-shrink-0" style="width: 18ch; min-width: 18ch; max-width: 18ch;">
            <mat-label>Property Code</mat-label>
            <input matInput [value]="propertyCode || ''" readonly [disabled]="true">
          </mat-form-field>
          <mat-form-field appearance="outline" style="width: 300px;">
            <mat-label>Reservation</mat-label>
            <mat-select [(ngModel)]="selectedReservationId" (selectionChange)="onReservationChange()">
              <mat-option [value]="null">Select Reservation</mat-option>
              @for (reservation of availableReservations; track reservation.value.reservationId) {
                <mat-option [value]="reservation.value.reservationId">{{ reservation.label }}</mat-option>
              }
            </mat-select>
          </mat-form-field>
        } @else {
          <mat-form-field appearance="outline" style="width: 300px;">
            <mat-label>{{ source === 'invoice' ? (selectedReservationId ? 'Reservation' : 'All Reservations') : 'Reservation' }}</mat-label>
            <mat-select [(ngModel)]="selectedReservationId" (selectionChange)="onReservationChange()">
              <mat-option [value]="null">All Reservations</mat-option>
              @for (reservation of availableReservations; track reservation.value.reservationId) {
                <mat-option [value]="reservation.value.reservationId">{{ reservation.label }}</mat-option>
              }
            </mat-select>
          </mat-form-field>
        }
      </div>
      <mat-card class="full-height-card">
        <div class="mat">
          <div class="tableDiv">
            <app-data-table
              [data]="emails"
              [columns]="emailsDisplayedColumns"
              [hasColumnIndex]="false"
              [hasFilter]="true"
              [hasToggleTop]="false"
              [hasActionsRowClick]="true"
              [hasActionsView]="true"
              [hasActionsEdit]="false"
              [hasActionsDelete]="false"
              [itemsPerPage]="100"
              (viewEvent)="viewEmail($event)"
              (attachmentClickEvent)="viewDocument($event)"
              (rowClickEvent)="viewEmail($event)"/>
          </div>
        </div>
      </mat-card>
    </div>
  } @else {
  <div class="flex content-card-wrap justify-center" fxLayout="row wrap">
    <section class="content-card">
      <div class="flex justify-between items-center gap-3 bg-slate-300 rounded-t-lg py-0 pl-8 pr-4">
        <span class="flex flex-column items-center gap-3 py-4">
          <mat-icon class="flex-shrink-0">mail</mat-icon>
          <span class="flex-shrink-0 text-xl font-medium">Emails</span>
        </span>
      </div>
      <mat-card>
        <div class="mat">
          <div class="flex gap-4 items-center mt-3 px-4">
            @if (showOfficeDropdown) {
              <mat-form-field appearance="outline" style="width: 300px;">
                <mat-label>{{ selectedOfficeId ? 'Office' : 'All Offices' }}</mat-label>
                <mat-select [(ngModel)]="selectedOfficeId" (selectionChange)="onOfficeChange()" [disabled]="source === 'property' || source === 'reservation'" placeholder="All Offices">
                  <mat-option [value]="null">All Offices</mat-option>
                  @for (office of offices; track office.officeId) {
                    <mat-option [value]="office.officeId">{{ office.name }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>
            }
            @if (source === 'invoice') {
              <mat-form-field appearance="outline" style="width: 300px;">
                <mat-label>{{ selectedCompany ? 'Company' : 'All Companies' }}</mat-label>
                <mat-select [(ngModel)]="selectedCompany" (selectionChange)="onCompanyChange()">
                  <mat-option [value]="null">All Companies</mat-option>
                  @for (company of availableCompanies; track company.value.companyId) {
                    <mat-option [value]="company.value">{{ company.label }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>
            }
            @if (source === 'property' || source === 'reservation') {
              <mat-form-field appearance="outline" class="flex-shrink-0" style="width: 18ch; min-width: 18ch; max-width: 18ch;">
                <mat-label>Property Code</mat-label>
                <input matInput [value]="propertyCode || ''" readonly [disabled]="true">
              </mat-form-field>
              <mat-form-field appearance="outline" style="width: 300px;">
                <mat-label>Reservation</mat-label>
                <mat-select [(ngModel)]="selectedReservationId" (selectionChange)="onReservationChange()">
                  <mat-option [value]="null">Select Reservation</mat-option>
                  @for (reservation of availableReservations; track reservation.value.reservationId) {
                    <mat-option [value]="reservation.value.reservationId">{{ reservation.label }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>
            } @else {
              <mat-form-field appearance="outline" style="width: 300px;">
                <mat-label>{{ source === 'invoice' ? (selectedReservationId ? 'Reservation' : 'All Reservations') : 'Reservation' }}</mat-label>
                <mat-select [(ngModel)]="selectedReservationId" (selectionChange)="onReservationChange()">
                  <mat-option [value]="null">All Reservations</mat-option>
                  @for (reservation of availableReservations; track reservation.value.reservationId) {
                    <mat-option [value]="reservation.value.reservationId">{{ reservation.label }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>
            }
          </div>
          <div class="tableDiv">
            <app-data-table
              [data]="emails"
              [columns]="emailsDisplayedColumns"
              [hasColumnIndex]="false"
              [hasFilter]="true"
              [hasToggleTop]="false"
              [hasActionsRowClick]="true"
              [hasActionsView]="true"
              [hasActionsEdit]="false"
              [hasActionsDelete]="false"
              [itemsPerPage]="100"
              (viewEvent)="viewEmail($event)"
              (attachmentClickEvent)="viewDocument($event)"
              (rowClickEvent)="viewEmail($event)"/>
          </div>
        </div>
      </mat-card>
    </section>
  </div>
  }
} @else {
  <div class="loading-container">
    <p>Could not load emails at this time.</p>
  </div>
}
