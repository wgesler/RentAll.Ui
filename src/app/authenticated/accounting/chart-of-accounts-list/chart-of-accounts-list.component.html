@if (!(isLoading$ | async)) {
  <div class="flex content-card-wrap justify-center" fxLayout="row wrap" [class.embedded-mode]="embeddedMode || hideHeader">
    <section class="content-card">
      @if (!embeddedMode && !hideHeader) {
        <div class="flex justify-between items-baseline bg-slate-200 rounded-t-lg px-8 py-4">
          <div class="flex items-baseline">
            <mat-icon mat-list-icon class="mr-5">account_tree</mat-icon>
            <h2 class="m-0">Chart of Accounts</h2>
          </div>
          <button mat-raised-button type="button" color="primary" id="add-button" (click)="addChartOfAccount()" class="scale-90 text-nowrap">
            <mat-icon>add</mat-icon>
            Add
          </button>
        </div>
      }
      <mat-card>
        <div class="mat">
          @if (hideHeader && !officeId) {
            <!-- Office dropdown, Inactive toggle, and Add button positioned inline with data-table filter -->
            <div class="flex justify-between gap-8 items-center mt-4 mobile-flex-column-reverse datatable-search-wrap px-4">
              <div style="flex: 1;"></div>
              <div class="flex justify-center lg:justify-end items-center gap-5 flex-wrap mobile-view-full mb-4">
                <mat-form-field appearance="outline" style="width: 300px;">
                  <mat-label>Office</mat-label>
                  <mat-select [(ngModel)]="selectedOfficeId" (selectionChange)="onOfficeChange()">
                    <mat-option [value]="null">Select Office</mat-option>
                    @for (office of offices; track office.officeId) {
                      <mat-option [value]="office.officeId">{{ office.name }}</mat-option>
                    }
                  </mat-select>
                </mat-form-field>
                <mat-slide-toggle id="toggle-chart-of-accounts-inactive" [checked]="showInactive" color="primary" (change)="toggleInactive()" class="whitespace-nowrap">
                  Inactive
                </mat-slide-toggle>
                <button mat-raised-button type="button" color="primary" id="add-button" (click)="addChartOfAccount()" class="mobile-view-full datatable-add-btn whitespace-nowrap items-center flex gap-1 scale-90">
                  <mat-icon class="text-base">add</mat-icon>
                  <span>Add</span>
                </button>
              </div>
            </div>
          } @else if (!embeddedMode && !officeId) {
            <div class="mb-4 px-4 pt-4 flex justify-between items-center">
              <mat-form-field appearance="outline" style="width: 300px;">
                <mat-label>Office</mat-label>
                <mat-select [(ngModel)]="selectedOfficeId" (selectionChange)="onOfficeChange()">
                  <mat-option [value]="null">Select Office</mat-option>
                  @for (office of offices; track office.officeId) {
                    <mat-option [value]="office.officeId">{{ office.name }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>
              <div class="flex items-center gap-5">
                <mat-slide-toggle id="toggle-chart-of-accounts-inactive" [checked]="showInactive" color="primary" (change)="toggleInactive()" class="whitespace-nowrap">
                  Inactive
                </mat-slide-toggle>
                <button mat-raised-button type="button" color="primary" id="add-button" (click)="addChartOfAccount()" class="scale-90 text-nowrap">
                  <mat-icon>add</mat-icon>
                  Add
                </button>
              </div>
            </div>
          }
          <!-- Controls are provided by parent when in embedded mode -->
          <div class="tableDiv">
            <app-data-table
              [data]="chartOfAccountsDisplay"
              [columns]="chartOfAccountsDisplayedColumns"
              [hasColumnIndex]="false"
              [hasFilter]="true"
              [hasToggleTop]="false"
              [hasActionsRowClick]="false"
              [hasActionsEdit]="true"
              [hasActionsDelete]="true"
              [itemsPerPage]="100"
              (editEvent)="goToChartOfAccount($event)"
              (deleteEvent)="deleteChartOfAccount($event)"/>
          </div>
        </div>
      </mat-card>
    </section>
  </div>
} @else {
  <div class="loading-container">
    <mat-spinner [diameter]="40"></mat-spinner>
    <p>Loading chart of accounts...</p>
  </div>
}
