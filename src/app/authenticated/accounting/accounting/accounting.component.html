<div class="flex content-card-wrap justify-center">
  <section class="content-card">
    <div class="flex justify-between items-center gap-3 bg-slate-300 rounded-t-lg py-0 pl-8 pr-4">
      <span class="flex flex-column items-center gap-3 py-4">
        <mat-icon class="flex-shrink-0">account_balance</mat-icon>
        <span class="flex-shrink-0 text-xl font-medium">Accounting</span>
      </span>
    </div>
    <mat-card>
      <mat-tab-group [selectedIndex]="selectedTabIndex" class="accounting-tabs" (selectedTabChange)="onTabChange($event)">
        <mat-tab label="Invoices">
          @if (isSuperAdmin) {
            <div class="list-top-controls list-top-controls--tabbed flex gap-3 items-center mt-3 px-4">
              <mat-form-field appearance="outline" style="width: 300px;">
                <mat-label>Organization</mat-label>
                <mat-select [(ngModel)]="selectedOrganizationId" (selectionChange)="onInvoiceOrganizationChange($event.value)">
                  @for (organization of organizations; track organization.organizationId) {
                    <mat-option [value]="organization.organizationId">{{ organization.name }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>
            </div>
          }
          <app-invoice-list 
            [hideFilters]="isSuperAdmin"
            [officeId]="selectedOfficeId"
            [reservationId]="selectedReservationId"
            [companyId]="selectedCompanyId"
            [organizationId]="selectedOrganizationId"
            [source]="'accounting'"
            (organizationIdChange)="onInvoiceOrganizationChange($event)"
            (officeIdChange)="onInvoiceOfficeChange($event)"
            (reservationIdChange)="onInvoiceReservationChange($event)"
            (companyIdChange)="onInvoiceCompanyChange($event)"
            (printInvoiceEvent)="onPrintInvoice($event)">
          </app-invoice-list>
        </mat-tab>
        <mat-tab label="Cost Codes">
          <app-cost-codes-list 
            [officeId]="selectedOfficeId"
            [embeddedInSettings]="true"
            (officeIdChange)="onCostCodesOfficeChange($event)">
          </app-cost-codes-list>
        </mat-tab>
        <mat-tab label="General Ledger">
          @if (isSuperAdmin) {
            <div class="list-top-controls list-top-controls--tabbed flex gap-3 items-center mt-3 px-4">
              <mat-form-field appearance="outline" style="width: 300px;">
                <mat-label>Organization</mat-label>
                <mat-select [(ngModel)]="selectedOrganizationId" (selectionChange)="onGeneralLedgerOrganizationChange($event.value)">
                  @for (organization of organizations; track organization.organizationId) {
                    <mat-option [value]="organization.organizationId">{{ organization.name }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>
            </div>
          }
          <app-general-ledger 
            [hideFilters]="isSuperAdmin"
            [officeId]="selectedOfficeId"
            [reservationId]="selectedReservationId"
            [companyId]="selectedCompanyId"
            [organizationId]="selectedOrganizationId"
            (organizationIdChange)="onGeneralLedgerOrganizationChange($event)"
            (officeIdChange)="onGeneralLedgerOfficeChange($event)"
            (reservationIdChange)="onGeneralLedgerReservationChange($event)"
            (companyIdChange)="onGeneralLedgerCompanyChange($event)">
          </app-general-ledger>
        </mat-tab>
        <mat-tab label="Emails">
          @if (isSuperAdmin) {
            <div class="list-top-controls list-top-controls--tabbed flex gap-3 items-center mt-3 px-4">
              <mat-form-field appearance="outline" style="width: 300px;">
                <mat-label>Organization</mat-label>
                <mat-select [(ngModel)]="selectedOrganizationId" (selectionChange)="onEmailsOrganizationChange($event.value)">
                  @for (organization of organizations; track organization.organizationId) {
                    <mat-option [value]="organization.organizationId">{{ organization.name }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>
            </div>
          }
          <app-email-list
            #accountingEmailList
            [hideHeader]="true"
            [hideFilters]="isSuperAdmin"
            [officeId]="selectedOfficeId"
            [reservationId]="selectedReservationId"
            [companyId]="selectedCompanyId"
            [organizationId]="selectedOrganizationId"
            [emailTypeId]="EmailType.Invoice"
            [source]="'invoice'"
            (organizationIdChange)="onEmailsOrganizationChange($event)"
            (officeIdChange)="onEmailsOfficeChange($event)"
            (reservationIdChange)="onEmailsReservationChange($event)"
            (companyIdChange)="onEmailsCompanyChange($event)">
          </app-email-list>
        </mat-tab>
        <mat-tab label="Documents">
          @if (isSuperAdmin) {
            <div class="list-top-controls list-top-controls--tabbed flex gap-3 items-center mt-3 px-4">
              <mat-form-field appearance="outline" style="width: 300px;">
                <mat-label>Organization</mat-label>
                <mat-select [(ngModel)]="selectedOrganizationId" (selectionChange)="onDocumentsOrganizationChange($event.value)">
                  @for (organization of organizations; track organization.organizationId) {
                    <mat-option [value]="organization.organizationId">{{ organization.name }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>
            </div>
          }
          <app-document-list 
            #accountingDocumentList
            [documentTypeId]="DocumentType.Invoice"
            [hideHeader]="true"
            [hideFilters]="isSuperAdmin"
            [officeId]="selectedOfficeId"
            [reservationId]="selectedReservationId"
            [companyId]="selectedCompanyId"
            [organizationId]="selectedOrganizationId"
            [source]="'invoice'"
            (organizationIdChange)="onDocumentsOrganizationChange($event)"
            (officeIdChange)="onDocumentsOfficeChange($event)"
            (reservationIdChange)="onDocumentsReservationChange($event)"
            (companyIdChange)="onDocumentsCompanyChange($event)">
          </app-document-list>
        </mat-tab>
      </mat-tab-group>
    </mat-card>
  </section>
</div>
