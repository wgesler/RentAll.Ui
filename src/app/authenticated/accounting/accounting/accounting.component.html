<div class="flex content-card-wrap justify-center">
  <section class="content-card">
    <div class="flex justify-between items-center gap-3 bg-slate-300 rounded-t-lg py-0 pl-8 pr-4">
      <span class="flex flex-column items-center gap-3 py-4">
        <mat-icon class="flex-shrink-0">account_balance</mat-icon>
        <span class="flex-shrink-0 text-xl font-medium">Accounting</span>
      </span>
    </div>
    <mat-card>
      <mat-tab-group [selectedIndex]="selectedTabIndex" class="accounting-tabs" (selectedTabChange)="onTabChange($event)">
        <mat-tab label="Invoices">
          @if (isSuperAdmin) {
            <div class="list-top-controls list-top-controls--tabbed flex gap-3 items-center mt-3 px-4">
              <mat-form-field appearance="outline" style="width: 300px;">
                <mat-label>Organization</mat-label>
                <mat-select [(ngModel)]="selectedOrganizationId" (selectionChange)="onOrganizationFilterChange()">
                  @for (organization of organizations; track organization.organizationId) {
                    <mat-option [value]="organization.organizationId">{{ organization.name }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>
              <mat-form-field appearance="outline" style="width: 300px;">
                <mat-label>{{ selectedOfficeId ? 'Office' : 'All Offices' }}</mat-label>
                <mat-select [(ngModel)]="selectedOfficeId" (selectionChange)="onOfficeFilterChange()">
                  <mat-option [value]="null">All Offices</mat-option>
                  @for (office of availableOffices; track office.officeId) {
                    <mat-option [value]="office.officeId">{{ office.name }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>
            </div>
          }
          <app-invoice-list 
            [hideFilters]="isSuperAdmin"
            [officeId]="selectedOfficeId"
            [reservationId]="selectedReservationId"
            [companyId]="selectedCompanyId"
            [source]="'accounting'"
            (officeIdChange)="onInvoiceOfficeChange($event)"
            (reservationIdChange)="onInvoiceReservationChange($event)"
            (companyIdChange)="onInvoiceCompanyChange($event)"
            (printInvoiceEvent)="onPrintInvoice($event)">
          </app-invoice-list>
        </mat-tab>
        <mat-tab label="Cost Codes">
          @if (isEditingCostCodes && costCodesId) {
            <app-cost-codes 
              [id]="costCodesId" 
              [officeId]="costCodesOfficeId"
              [source]="'accounting'"
              (backEvent)="onCostCodesBack()"
              (savedEvent)="onCostCodesSaved()">
            </app-cost-codes>
          } @else {
            <app-cost-codes-list 
              [officeId]="selectedOfficeId"
              (officeIdChange)="onCostCodesOfficeChange($event)"
              (addCostCodeEvent)="onCostCodesAdd()"
              (editCostCodeEvent)="onCostCodesEdit($event)">
            </app-cost-codes-list>
          }
        </mat-tab>
        <mat-tab label="General Ledger">
          @if (isSuperAdmin) {
            <div class="list-top-controls list-top-controls--tabbed flex gap-3 items-center mt-3 px-4">
              <mat-form-field appearance="outline" style="width: 300px;">
                <mat-label>Organization</mat-label>
                <mat-select [(ngModel)]="selectedOrganizationId" (selectionChange)="onOrganizationFilterChange()">
                  @for (organization of organizations; track organization.organizationId) {
                    <mat-option [value]="organization.organizationId">{{ organization.name }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>
              <mat-form-field appearance="outline" style="width: 300px;">
                <mat-label>{{ selectedOfficeId ? 'Office' : 'All Offices' }}</mat-label>
                <mat-select [(ngModel)]="selectedOfficeId" (selectionChange)="onOfficeFilterChange()">
                  <mat-option [value]="null">All Offices</mat-option>
                  @for (office of availableOffices; track office.officeId) {
                    <mat-option [value]="office.officeId">{{ office.name }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>
            </div>
          }
          <app-general-ledger 
            [hideFilters]="isSuperAdmin"
            [officeId]="selectedOfficeId"
            [reservationId]="selectedReservationId"
            [companyId]="selectedCompanyId"
            (officeIdChange)="onGeneralLedgerOfficeChange($event)"
            (reservationIdChange)="onGeneralLedgerReservationChange($event)"
            (companyIdChange)="onGeneralLedgerCompanyChange($event)">
          </app-general-ledger>
        </mat-tab>
        <mat-tab label="Emails">
          @if (isSuperAdmin) {
            <div class="list-top-controls list-top-controls--tabbed flex gap-3 items-center mt-3 px-4">
              <mat-form-field appearance="outline" style="width: 300px;">
                <mat-label>Organization</mat-label>
                <mat-select [(ngModel)]="selectedOrganizationId" (selectionChange)="onOrganizationFilterChange()">
                  @for (organization of organizations; track organization.organizationId) {
                    <mat-option [value]="organization.organizationId">{{ organization.name }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>
              <mat-form-field appearance="outline" style="width: 300px;">
                <mat-label>{{ selectedOfficeId ? 'Office' : 'All Offices' }}</mat-label>
                <mat-select [(ngModel)]="selectedOfficeId" (selectionChange)="onOfficeFilterChange()">
                  <mat-option [value]="null">All Offices</mat-option>
                  @for (office of availableOffices; track office.officeId) {
                    <mat-option [value]="office.officeId">{{ office.name }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>
            </div>
          }
          <app-email-list
            #accountingEmailList
            [hideHeader]="true"
            [hideFilters]="isSuperAdmin"
            [officeId]="selectedOfficeId"
            [reservationId]="selectedReservationId"
            [companyId]="selectedCompanyId"
            [emailTypeId]="EmailType.Invoice"
            [source]="'invoice'"
            (officeIdChange)="onEmailsOfficeChange($event)"
            (reservationIdChange)="onEmailsReservationChange($event)"
            (companyIdChange)="onEmailsCompanyChange($event)">
          </app-email-list>
        </mat-tab>
        <mat-tab label="Documents">
          @if (isSuperAdmin) {
            <div class="list-top-controls list-top-controls--tabbed flex gap-3 items-center mt-3 px-4">
              <mat-form-field appearance="outline" style="width: 300px;">
                <mat-label>Organization</mat-label>
                <mat-select [(ngModel)]="selectedOrganizationId" (selectionChange)="onOrganizationFilterChange()">
                  @for (organization of organizations; track organization.organizationId) {
                    <mat-option [value]="organization.organizationId">{{ organization.name }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>
              <mat-form-field appearance="outline" style="width: 300px;">
                <mat-label>{{ selectedOfficeId ? 'Office' : 'All Offices' }}</mat-label>
                <mat-select [(ngModel)]="selectedOfficeId" (selectionChange)="onOfficeFilterChange()">
                  <mat-option [value]="null">All Offices</mat-option>
                  @for (office of availableOffices; track office.officeId) {
                    <mat-option [value]="office.officeId">{{ office.name }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>
            </div>
          }
          <app-document-list 
            #accountingDocumentList
            [documentTypeId]="DocumentType.Invoice"
            [hideHeader]="true"
            [hideFilters]="isSuperAdmin"
            [officeId]="selectedOfficeId"
            [reservationId]="selectedReservationId"
            [companyId]="selectedCompanyId"
            [source]="'invoice'"
            (officeIdChange)="onDocumentsOfficeChange($event)"
            (reservationIdChange)="onDocumentsReservationChange($event)"
            (companyIdChange)="onDocumentsCompanyChange($event)">
          </app-document-list>
        </mat-tab>
      </mat-tab-group>
    </mat-card>
  </section>
</div>
