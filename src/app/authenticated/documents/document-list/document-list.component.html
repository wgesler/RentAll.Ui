@if (!(isLoading$ | async)) {
  @if (hideHeader) {
    <!-- Full-page layout when inside a tab -->
    <div class="document-list-tab-container">
      <!-- Office and conditional field dropdown row -->
      <div class="flex gap-4 items-center mt-3 px-4">
        @if (showOfficeDropdown) {
          <mat-form-field appearance="outline" style="width: 300px;">
            <mat-label>{{ selectedOfficeId ? 'Office' : 'All Offices' }}</mat-label>
            <mat-select [(ngModel)]="selectedOfficeId" (selectionChange)="onOfficeChange()" [disabled]="isOfficeDisabled" placeholder="All Offices">
              <mat-option [value]="null">All Offices</mat-option>
              @for (office of offices; track office.officeId) {
                <mat-option [value]="office.officeId">{{ office.name }}</mat-option>
              }
            </mat-select>
          </mat-form-field>
        }
        @if (source === 'reservation' || source === 'invoice') {
          @if (source === 'reservation') {
            <mat-form-field appearance="outline" class="flex-shrink-0" style="width: 18ch; min-width: 18ch; max-width: 18ch;">
              <mat-label>Property Code</mat-label>
              <input matInput [value]="propertyCode || ''" readonly [disabled]="true">
            </mat-form-field>
          }
          @if (source === 'invoice') {
            <mat-form-field appearance="outline" style="width: 300px;">
              <mat-label>{{ selectedCompany ? 'Company' : 'All Companies' }}</mat-label>
              <mat-select [(ngModel)]="selectedCompany" (selectionChange)="onCompanyChange()">
                <mat-option [value]="null">All Companies</mat-option>
                @for (company of availableCompanies; track company.value.companyId) {
                  <mat-option [value]="company.value">{{ company.label }}</mat-option>
                }
              </mat-select>
            </mat-form-field>
          }
          <!-- Reservation field for Reservations or Accounting source -->
          <mat-form-field appearance="outline" style="width: 300px;">
            <mat-label>{{ source === 'invoice' ? (selectedReservationId ? 'Reservation' : 'All Reservations') : 'Reservation' }}</mat-label>
            <mat-select [(ngModel)]="selectedReservationId" (selectionChange)="onReservationChange()" [disabled]="isReservationDisabled">
              <mat-option [value]="null">{{ source === 'invoice' ? 'All Reservations' : 'Select Reservation' }}</mat-option>
              @for (reservation of availableReservations; track reservation.value.reservationId) {
                <mat-option [value]="reservation.value.reservationId">{{ reservation.label }}</mat-option>
              }
            </mat-select>
          </mat-form-field>
        } @else if (source === 'property') {
          <!-- Property Code and Reservation fields for Properties source -->
          <mat-form-field appearance="outline" class="flex-shrink-0" style="width: 18ch; min-width: 18ch; max-width: 18ch;">
            <mat-label>Property Code</mat-label>
            <input matInput [value]="propertyCode || ''" readonly [disabled]="true">
          </mat-form-field>
          <mat-form-field appearance="outline" style="width: 300px;">
            <mat-label>Reservation</mat-label>
            <mat-select [(ngModel)]="selectedReservationId" (selectionChange)="onReservationChange()">
              <mat-option [value]="null">Select Reservation</mat-option>
              @for (reservation of availableReservations; track reservation.value.reservationId) {
                <mat-option [value]="reservation.value.reservationId">{{ reservation.label }}</mat-option>
              }
            </mat-select>
          </mat-form-field>
        } @else if (source === 'documents') {
          <!-- Reservation and DocumentType fields for Documents source -->
          <mat-form-field appearance="outline" style="width: 300px;">
            <mat-label>Reservation</mat-label>
            <mat-select [(ngModel)]="selectedReservationId" (selectionChange)="onReservationChange()">
              <mat-option [value]="null">All Reservations</mat-option>
              @for (reservation of availableReservations; track reservation.value.reservationId) {
                <mat-option [value]="reservation.value.reservationId">{{ reservation.label }}</mat-option>
              }
            </mat-select>
          </mat-form-field>
          <mat-form-field appearance="outline" style="width: 300px;">
            <mat-label>Document Type</mat-label>
            <mat-select [(ngModel)]="selectedDocumentTypeId" (selectionChange)="onDocumentTypeChange()">
              <mat-option [value]="null">All Document Types</mat-option>
              @for (docType of documentTypes; track docType.value) {
                <mat-option [value]="docType.value">{{ docType.label }}</mat-option>
              }
            </mat-select>
          </mat-form-field>
        }
      </div>
      <mat-card class="full-height-card">
        <div class="mat">
          <div class="tableDiv">
            <app-data-table
              [data]="documentsDisplay"
              [columns]="documentsDisplayedColumns"
              [hasColumnIndex]="false"
              [hasFilter]="true"
              [hasToggleTop]="false"
              [hasActionsRowClick]="true"
              [hasActionsView]="true"
              [hasActionsEdit]="false"
              [hasActionsDownload]="true"
              [hasActionsDelete]="true"
              [itemsPerPage]="100"
              (viewEvent)="viewDocument($event)"
              (downloadEvent)="downloadDocument($event)"
              (rowClickEvent)="viewDocument($event)"
              (deleteEvent)="deleteDocument($event)"/>
          </div>
        </div>
      </mat-card>
    </div>
  } @else {
    <!-- Standard layout with header -->
    <div class="flex content-card-wrap justify-center" fxLayout="row wrap">
      <section class="content-card">
        <div class="flex justify-between items-center gap-3 bg-slate-300 rounded-t-lg py-0 pl-8 pr-4">
          <span class="flex flex-column items-center gap-3 py-4">
            <mat-icon class="flex-shrink-0">description</mat-icon>
            <span class="flex-shrink-0 text-xl font-medium">Documents</span>
          </span>
        </div>
        <mat-card>
          <div class="mat">
            <!-- Office and conditional field dropdown row -->
            <div class="flex justify-between items-center gap-3 mt-4 px-4 flex-wrap" style="height: 56px;">
              <div class="flex items-center gap-3" style="height: 56px;">
                @if (showOfficeDropdown) {
                  <mat-form-field appearance="outline" style="width: 300px;">
                    <mat-label>{{ selectedOfficeId ? 'Office' : 'All Offices' }}</mat-label>
                    <mat-select [(ngModel)]="selectedOfficeId" (selectionChange)="onOfficeChange()" [disabled]="isOfficeDisabled" placeholder="All Offices">
                      <mat-option [value]="null">All Offices</mat-option>
                      @for (office of offices; track office.officeId) {
                        <mat-option [value]="office.officeId">{{ office.name }}</mat-option>
                      }
                    </mat-select>
                  </mat-form-field>
                }
                @if (source === 'reservation' || source === 'invoice') {
                  @if (source === 'reservation') {
                    <mat-form-field appearance="outline" class="flex-shrink-0" style="width: 18ch; min-width: 18ch; max-width: 18ch;">
                      <mat-label>Property Code</mat-label>
                      <input matInput [value]="propertyCode || ''" readonly [disabled]="true">
                    </mat-form-field>
                  }
                  @if (source === 'invoice') {
                    <mat-form-field appearance="outline" style="width: 300px;">
                      <mat-label>{{ selectedCompany ? 'Company' : 'All Companies' }}</mat-label>
                      <mat-select [(ngModel)]="selectedCompany" (selectionChange)="onCompanyChange()">
                        <mat-option [value]="null">All Companies</mat-option>
                        @for (company of availableCompanies; track company.value.companyId) {
                          <mat-option [value]="company.value">{{ company.label }}</mat-option>
                        }
                      </mat-select>
                    </mat-form-field>
                  }
                  <!-- Reservation field for Reservations or Accounting source -->
                  <mat-form-field appearance="outline" style="width: 300px;">
                    <mat-label>{{ source === 'invoice' ? (selectedReservationId ? 'Reservation' : 'All Reservations') : 'Reservation' }}</mat-label>
                    <mat-select [(ngModel)]="selectedReservationId" (selectionChange)="onReservationChange()" [disabled]="isReservationDisabled">
                      <mat-option [value]="null">{{ source === 'invoice' ? 'All Reservations' : 'Select Reservation' }}</mat-option>
                      @for (reservation of availableReservations; track reservation.value.reservationId) {
                        <mat-option [value]="reservation.value.reservationId">{{ reservation.label }}</mat-option>
                      }
                    </mat-select>
                  </mat-form-field>
                } @else if (source === 'property') {
                  <!-- Property Code and Reservation fields for Properties source -->
                  <mat-form-field appearance="outline" class="flex-shrink-0" style="width: 18ch; min-width: 18ch; max-width: 18ch;">
                    <mat-label>Property Code</mat-label>
                    <input matInput [value]="propertyCode || ''" readonly [disabled]="true">
                  </mat-form-field>
                  <mat-form-field appearance="outline" style="width: 300px;">
                    <mat-label>Reservation</mat-label>
                    <mat-select [(ngModel)]="selectedReservationId" (selectionChange)="onReservationChange()">
                      <mat-option [value]="null">Select Reservation</mat-option>
                      @for (reservation of availableReservations; track reservation.value.reservationId) {
                        <mat-option [value]="reservation.value.reservationId">{{ reservation.label }}</mat-option>
                      }
                    </mat-select>
                  </mat-form-field>
                } @else if (source === 'documents') {
                  <!-- Reservation and DocumentType fields for Documents source -->
                  <mat-form-field appearance="outline" style="width: 300px;">
                    <mat-label>Reservation</mat-label>
                    <mat-select [(ngModel)]="selectedReservationId" (selectionChange)="onReservationChange()">
                      <mat-option [value]="null">All Reservations</mat-option>
                      @for (reservation of availableReservations; track reservation.value.reservationId) {
                        <mat-option [value]="reservation.value.reservationId">{{ reservation.label }}</mat-option>
                      }
                    </mat-select>
                  </mat-form-field>
                  <mat-form-field appearance="outline" style="width: 300px;">
                    <mat-label>Document Type</mat-label>
                    <mat-select [(ngModel)]="selectedDocumentTypeId" (selectionChange)="onDocumentTypeChange()">
                      <mat-option [value]="null">All Document Types</mat-option>
                      @for (docType of documentTypes; track docType.value) {
                        <mat-option [value]="docType.value">{{ docType.label }}</mat-option>
                      }
                    </mat-select>
                  </mat-form-field>
                }
              </div>
            </div>
            <div class="tableDiv">
              <app-data-table
                [data]="documentsDisplay"
                [columns]="documentsDisplayedColumns"
                [hasColumnIndex]="false"
                [hasFilter]="true"
                [hasToggleTop]="false"
                [hasButtonTop]="true"
                [hasActionsRowClick]="true"
                [hasActionsView]="true"
                [hasActionsEdit]="false"
                [hasActionsDownload]="true"
                [hasActionsDelete]="true"
                [itemsPerPage]="100"
                [buttonTextTop]="'Add'"
                [buttonIconTop]="'add'"
                [buttonColorTop]="'primary'"
                (topButtonEvent)="addDocument()"
                (viewEvent)="viewDocument($event)"
                (downloadEvent)="downloadDocument($event)"
                (rowClickEvent)="viewDocument($event)"
                (deleteEvent)="deleteDocument($event)"/>
            </div>
          </div>
        </mat-card>
      </section>
    </div>
  }
} @else {
  <div class="loading-container">
    <mat-spinner [diameter]="40"></mat-spinner>
    <p>Loading documents...</p>
  </div>
}

