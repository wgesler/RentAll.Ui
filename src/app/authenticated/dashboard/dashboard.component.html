<div class="flex content-card-wrap justify-center">
  <section class="content-card">
    <div class="flex justify-between items-center gap-3 bg-slate-300 rounded-t-lg py-0 pl-8 pr-4">
      <span class="flex flex-column items-center gap-3 py-4">
        <mat-icon class="flex-shrink-0">dashboard</mat-icon>
        <span class="flex-shrink-0 text-xl font-medium" style="font-size: 2rem;">Dashboard</span>
      </span>
    </div>
    <mat-card>
      <div class="dashboard-content">
        <!-- Welcome Tile -->
        <div class="welcome-tile">
          <div class="welcome-content">
            @if (profilePictureUrl) {
              <img [src]="profilePictureUrl" alt="Profile Picture" class="profile-picture" />
            } @else {
              <mat-icon class="profile-icon">person</mat-icon>
            }
            <div class="welcome-text">
              <span class="welcome-label">Welcome</span>
              <span class="user-name">{{ getFullName() }}</span>
            </div>
          </div>
          <div class="date-display-inline">
            <p class="date-text">{{ todayDate }}</p>
          </div>
        </div>

        <!-- Main Content Area with Tables and Sidebar -->
        <div class="dashboard-main-content">
          <!-- Reservation Tables -->
          <div class="reservation-tables">
            <!-- Upcoming Arrivals Table -->
            <mat-expansion-panel 
              class="reservation-section"
              [(expanded)]="arrivalsExpanded">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <h2 class="section-title">Upcoming Arrivals (Next 15 Days)</h2>
                </mat-panel-title>
              </mat-expansion-panel-header>
              @if (isLoadingReservations) {
                <div class="loading-container">
                  <mat-spinner [diameter]="40"></mat-spinner>
                  <p>Loading reservations...</p>
                </div>
              } @else {
                <div class="tableDiv">
                  <app-data-table
                    [data]="upcomingArrivals"
                    [columns]="reservationsDisplayedColumns"
                    [hasColumnIndex]="false"
                    [hasFilter]="false"
                    [hasToggleTop]="false"
                    [hasButtonTop]="false"
                    [hasActionsRowClick]="true"
                    [hasActionsEdit]="false"
                    [hasActionsDelete]="false"
                    [itemsPerPage]="50"
                    (rowClickEvent)="goToReservation($event)"
                    (contactClickEvent)="goToContact($event)"/>
                </div>
              }
            </mat-expansion-panel>

            <!-- Upcoming Departures Table -->
            <mat-expansion-panel 
              class="reservation-section"
              [(expanded)]="departuresExpanded">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <h2 class="section-title">Upcoming Departures (Next 15 Days)</h2>
                </mat-panel-title>
              </mat-expansion-panel-header>
              @if (isLoadingReservations) {
                <div class="loading-container">
                  <mat-spinner [diameter]="40"></mat-spinner>
                  <p>Loading reservations...</p>
                </div>
              } @else {
                <div class="tableDiv">
                  <app-data-table
                    [data]="upcomingDepartures"
                    [columns]="reservationsDisplayedColumns"
                    [hasColumnIndex]="false"
                    [hasFilter]="false"
                    [hasToggleTop]="false"
                    [hasButtonTop]="false"
                    [hasActionsRowClick]="true"
                    [hasActionsEdit]="false"
                    [hasActionsDelete]="false"
                    [itemsPerPage]="50"
                    (rowClickEvent)="goToReservation($event)"
                    (contactClickEvent)="goToContact($event)"/>
                </div>
              }
            </mat-expansion-panel>

            <!-- Properties by Vacancy Table -->
            <mat-expansion-panel 
              class="reservation-section"
              [(expanded)]="propertiesExpanded">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <h2 class="section-title">Properties by Vacancy Duration</h2>
                </mat-panel-title>
              </mat-expansion-panel-header>
              @if (isLoadingProperties || isLoadingReservations) {
                <div class="loading-container">
                  <mat-spinner [diameter]="40"></mat-spinner>
                  <p>Loading properties...</p>
                </div>
              } @else {
                <div class="tableDiv">
                  <app-data-table
                    [data]="propertiesByVacancy"
                    [columns]="propertiesDisplayedColumns"
                    [hasColumnIndex]="false"
                    [hasFilter]="false"
                    [hasToggleTop]="false"
                    [hasButtonTop]="false"
                    [hasActionsRowClick]="true"
                    [hasActionsEdit]="false"
                    [hasActionsDelete]="false"
                    [itemsPerPage]="50"
                    (rowClickEvent)="goToProperty($event)"/>
                </div>
              }
            </mat-expansion-panel>
          </div>

          <!-- Right Sidebar -->
          <aside class="dashboard-sidebar">
            <div class="sidebar-content">
              <!-- Today Box -->
              <div class="day-box day-box-today">
                <div class="day-box-text">
                  <h4 class="day-title">
                    <span>Arrivals/Departures</span>
                    <span class="day-name">Today</span>
                  </h4>
                  <div class="icon-number-row">
                    <mat-icon class="calendar-icon-below">calendar_today</mat-icon>
                    <span class="total-number">{{ getTodayTotal() }}</span>
                  </div>
                </div>
              </div>
              
              <!-- Tomorrow Box -->
              <div class="day-box day-box-tomorrow">
                <div class="day-box-text">
                  <h4 class="day-title">
                    <span>Arrivals/Departures</span>
                    <span class="day-name">Tomorrow</span>
                  </h4>
                  <div class="icon-number-row">
                    <mat-icon class="calendar-icon-below">event</mat-icon>
                    <span class="total-number">{{ getTomorrowTotal() }}</span>
                  </div>
                </div>
              </div>

              <!-- Properties Box -->
              <div class="day-box day-box-reservations">
                <div class="day-box-text">
                  <h4 class="day-title">
                    <span>Properties</span>
                  </h4>
                  @if (isLoadingProperties) {
                    <div class="loading-container-small">
                      <mat-spinner [diameter]="24"></mat-spinner>
                    </div>
                  } @else {
                    <div class="reservations-stats">
                      <div class="stat-row">
                        <span class="stat-label">Rented:</span>
                        <span class="stat-value">{{ rentedCount }}</span>
                      </div>
                      <div class="stat-row">
                        <span class="stat-label">Vacant:</span>
                        <span class="stat-value">{{ vacantCount }}</span>
                      </div>
                    </div>
                  }
                </div>
              </div>
            </div>
          </aside>
        </div>
      </div>
    </mat-card>
  </section>
</div>
