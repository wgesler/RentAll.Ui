<div class="flex content-card-wrap justify-center" fxLayout="row wrap">
  <section class="content-card">
    <div class="flex justify-between items-baseline bg-slate-200 rounded-t-lg px-8 py-4">
      <div class="flex items-baseline">
        <mat-icon mat-list-icon class="mr-5">calendar_today</mat-icon>
        <h2 class="m-0">Reservations</h2>
      </div>
      <div class="flex items-center gap-3">
        <mat-form-field appearance="outline" class="scale-90" style="width: 170px;">
          <mat-label>Start Date</mat-label>
          <input
            matInput
            [matDatepicker]="startDatePicker"
            [(ngModel)]="startDate"
            [ngModelOptions]="{ standalone: true }"
            (dateChange)="onStartDateChange()"
            [max]="endDate" />
          <mat-datepicker-toggle matIconSuffix [for]="startDatePicker"></mat-datepicker-toggle>
          <mat-datepicker #startDatePicker></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="outline" class="scale-90" style="width: 170px;">
          <mat-label>End Date</mat-label>
          <input
            matInput
            [matDatepicker]="endDatePicker"
            [(ngModel)]="endDate"
            [ngModelOptions]="{ standalone: true }"
            (dateChange)="onEndDateChange()"
            [min]="startDate" />
          <mat-datepicker-toggle matIconSuffix [for]="endDatePicker"></mat-datepicker-toggle>
          <mat-datepicker #endDatePicker></mat-datepicker>
        </mat-form-field>

        <button 
          mat-raised-button 
          type="button" 
          (click)="clearDateFilters()" 
          class="scale-90 text-nowrap clear-button"
          [disabled]="!startDate && !endDate">
          Clear
        </button>

        <button mat-raised-button type="button" color="primary" id="add-button" (click)="addReservation()" class="scale-90 text-nowrap">
          <mat-icon>add</mat-icon>
          Add
        </button>
      </div>
    </div>
    <mat-card>
      @if (isLoading$ | async) {
        <div class="loading-container">
          <mat-spinner [diameter]="40"></mat-spinner>
          <p>Loading reservations...</p>
        </div>
      } @else if (isServiceError) {
        <div class="flex justify-center items-center p-8">
          <div class="text-center">
            <mat-icon class="text-6xl text-red-500 mb-4">error_outline</mat-icon>
            <h3 class="text-xl font-semibold mb-2">Unable to Load Reservations</h3>
            <p class="text-gray-600">There was an error loading the reservations. Please try again or contact support if the problem persists.</p>
          </div>
        </div>
      } @else {
        <div class="mat">
          <!-- Office dropdown row - just above data table -->
          @if (showOfficeDropdown) {
            <div class="flex gap-3 items-center mt-4 px-4">
              <mat-form-field appearance="outline" class="office-dropdown">
                <mat-label>All Offices</mat-label>
                <mat-select [(ngModel)]="selectedOffice" (selectionChange)="onOfficeChange()" [ngModelOptions]="{ standalone: true }">
                  <mat-option [value]="null">All Offices</mat-option>
                  @for (office of offices; track office.officeId) {
                    <mat-option [value]="office">{{ office.name }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>
            </div>
          }
          <div class="tableDiv">
            <app-data-table
              [data]="reservationsDisplay"
              [columns]="reservationsDisplayedColumns"
              [hasColumnIndex]="false"
              [hasFilter]="true"
              [hasToggleTop]="true"
              [hasActionsRowClick]="true"
              [hasActionsEdit]="true"
              [hasActionsDelete]="true"
              [itemsPerPage]="100"
              buttonToggleTextTop="Inactive"
              (topToggleButtonEvent)="toggleInactive()"
              (editEvent)="goToReservation($event)"
              (rowClickEvent)="goToReservation($event)"
              (deleteEvent)="deleteReservation($event)"
              (contactClickEvent)="goToContact($event)"/>
          </div>
        </div>
      }
    </mat-card>
  </section>
</div>

